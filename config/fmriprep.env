# fMRIPrep pipeline config (sourced by bash)

# ---- inputs ----
BIDS_ROOT="${BIDS_ROOT:-${PROJECT_ROOT}/bids}"

# ---- outputs ----
DERIV_ROOT="${PROJECT_ROOT}/derivatives/fmriprep"
FS_SUBJECTS_DIR="${PROJECT_ROOT}/derivatives/freesurfer"

# ---- work & logs ----
WORK_ROOT="${PROJECT_ROOT}/work/fmriprep"
BIDS_DB_DIR="${PROJECT_ROOT}/work/pybids_db"
PARTICIPANTS_TSV="${PROJECT_ROOT}/work/fmriprep_participants.tsv"
LOGDIR="${PROJECT_ROOT}/logs/fmriprep"

# ---- state files (DONE/FAILED/RUNNING/LOCK) ----
STATE_DIR="${LOGDIR}/state"
DONE_DIR="${STATE_DIR}/done"
FAILED_DIR="${STATE_DIR}/failed"
RUNNING_DIR="${STATE_DIR}/running"
LOCK_DIR="${STATE_DIR}/lock"

# ---- container ----
FMRIPREP_SIF="${CONTAINERS_ROOT}/fmriprep-25.2.3.sif"

# ---- FreeSurfer license ----
FS_LICENSE="${PROJECT_ROOT}/license.txt"

# ---- concurrency ----
MAX_JOBS="${MAX_JOBS:-2}"

# ---- per-job resources ----
NTHREADS="${NTHREADS:-8}"
OMP_NTHREADS="${OMP_NTHREADS:-4}"
MEM_MB="${MEM_MB:-32000}"

# ---- BIDS DB build behavior ----
RESET_BIDS_DB="${RESET_BIDS_DB:-1}"
INDEX_METADATA="${INDEX_METADATA:-1}"

# ---- output spaces ----
OUTPUT_SPACES="${OUTPUT_SPACES:-MNI152NLin2009cAsym:res-2 MNI152NLin6Asym:res-2 T1w}"

# ---- CIFTI output ----
CIFTI_OUTPUT="${CIFTI_OUTPUT:-91k}"

# ---- validation strategy ----
SKIP_BIDS_VALIDATION="${SKIP_BIDS_VALIDATION:-1}"

# ---- cleanup behavior ----
CLEAN_WORK_ON_SUCCESS="${CLEAN_WORK_ON_SUCCESS:-1}"
WIPE_WORKDIR_ON_START="${WIPE_WORKDIR_ON_START:-0}"

# ---- queue mode default ----
QUEUE_MODE_DEFAULT="${QUEUE_MODE_DEFAULT:-pending}"
